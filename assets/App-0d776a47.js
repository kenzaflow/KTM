import{r as m,j,L}from"./index-7337e253.js";const N={floorBlank:"floor-blank.svg",floorDeath:"floor-death.svg",charBody:"char-body.svg",charEyesCenter:"char-eyes-center.svg",charMouthNormal:"char-mouth-normal.svg",zombieBody:"zombie-body.svg",zombieEyesCenter:"zombie-eyes-center.svg",zombieMouthNormal:"zombie-mouth-normal.svg",cursor:"cursor.png"};function F({FPS:{refFPS:c,refFPSCounter:n,refFPSStart:l}}){return()=>{n.current+=1;const t=performance.now(),o=t-l.current;o>=1e3&&(c.current=Math.round(n.current/(o/1e3)),n.current=0,l.current=t)}}function H({tiles:{refTileSize:c,refTilesX:n,refTilesY:l}}){return({context:t})=>{const o=Math.min(Math.floor(t.canvas.width/n.current),Math.floor(t.canvas.height/l.current)),u=o-o%2;c.current!==u&&(c.current=Math.round(u))}}function I(c,n,l,t){const o=()=>{const s=Math.floor(1+Math.random()*(n-2)),a=Math.floor(1+Math.random()*(l/2));return{x:s,y:a}},u=[];for(let s=0;s<10;s++){let a;do a=o();while(u.some(i=>i.position.x===a.x&&i.position.y===a.y)&&a.x!==t.x&&a.y!==t.y);u.push({type:"zombie",position:{...a},screen:{...a},alive:!0})}return u}function W({input:{refKeyDown:c},characters:{refUser:n,refBots:l},tiles:{refTilesX:t,refTilesY:o},game:{refLevel:u,refMenu:s},maps:{refMapCurrent:a}}){const i="KeyW",d="ArrowUp",h="KeyS",g="ArrowDown",w="KeyA",E="ArrowLeft",S="KeyD",p="ArrowRight";return({ticks:T})=>{const M=y=>{c.current[y]=!1},x=()=>{a.current=2,n.current.position.x=Math.round(t.current/2-1),n.current.position.y=Math.round(o.current-2),n.current.screen.x=Math.round(t.current/2-1),n.current.screen.y=Math.round(o.current-2),u.current.level=1,u.current.score=0,u.current.timeToMove=void 0,u.current.lost=!1,l.current=I(u.current.level,t.current,o.current,n.current.position),s.current.screen="playing"},v=()=>{n.current.position={x:Math.round(t.current/2-1),y:Math.round(o.current/2-1)},n.current.screen={x:Math.round(t.current/2-1),y:Math.round(o.current/2-1)},l.current=[],a.current=1,s.current.screen="home",s.current.screenSelection="play"};if(s.current.screen==="home"){const y=(f,b)=>{f==="up"?s.current.screenSelection==="play"?s.current.screenSelection="settings":s.current.screenSelection==="help"?s.current.screenSelection="play":s.current.screenSelection==="settings"&&(s.current.screenSelection="help"):f==="down"&&(s.current.screenSelection==="play"?s.current.screenSelection="help":s.current.screenSelection==="help"?s.current.screenSelection="settings":s.current.screenSelection==="settings"&&(s.current.screenSelection="play")),M(b)};c.current[i]&&y("up",i),c.current[d]&&y("up",d),c.current[h]&&y("down",h),c.current[g]&&y("down",g),c.current.Enter&&s.current.screenSelection==="play"&&(x(),M("Enter"))}if(s.current.screen==="playing"&&(u.current.lost&&(v(),M("Escape")),c.current.Escape&&(v(),M("Escape")),n.current.speed=10,c.current[i]||c.current[d]||c.current[h]||c.current[g]||c.current[w]||c.current[E]||c.current[S]||c.current[p])){const y={KeyW:c.current[i],ArrowUp:c.current[d],KeyS:c.current[h],ArrowDown:c.current[g],KeyA:c.current[w],ArrowLeft:c.current[E],KeyD:c.current[S],ArrowRight:c.current[p]};let f=null;if(Object.keys(y).forEach(b=>{y[b]&&(!f||y[b]>y[f])&&(f=b)}),f){const b=()=>{c.current[i]&&c.current[d]&&(n.current.speed=16),n.current.screen.x===n.current.position.x&&n.current.screen.y===n.current.position.y&&n.current.position.y>0&&(n.current.position.y-=1)},B=()=>{c.current[h]&&c.current[g]&&(n.current.speed=16),n.current.screen.x===n.current.position.x&&n.current.screen.y===n.current.position.y&&n.current.position.y<o.current-1&&(n.current.position.y+=1)},k=()=>{c.current[w]&&c.current[E]&&(n.current.speed=16),n.current.screen.x===n.current.position.x&&n.current.screen.y===n.current.position.y&&n.current.position.x>0&&(n.current.position.x-=1)},z=()=>{c.current[S]&&c.current[p]&&(n.current.speed=16),n.current.screen.x===n.current.position.x&&n.current.screen.y===n.current.position.y&&n.current.position.x<t.current-1&&(n.current.position.x+=1)};s.current.screen==="playing"&&((f===i||f===d)&&b(),(f===h||f===g)&&B(),(f===w||f===E)&&k(),(f===S||f===p)&&z())}}}}function C({characters:{refUser:c,refBots:n},game:{refMenu:l,refLevel:t},tiles:{refTilesY:o,refTilesX:u,refTileSize:s}}){return({ticks:a})=>{if(l.current.screen!=="playing")return;const i=c.current.speed*(a/1e3),{screen:d,position:h}=c.current,g=()=>{n.current.forEach(p=>{if(s.current&&p.alive){const R=d.x*s.current,A=d.y*s.current,T=s.current,M=s.current,x=p.screen.x*s.current,v=p.screen.y*s.current,y=s.current,f=s.current;R>=x&&R+T<=x+y&&A>=v&&A+M<=v+f&&(p.alive=!1,t.current.score+=1)}}),n.current.every(p=>!p.alive)&&(t.current.level+=1,t.current.timeToMove=void 0,n.current=I(t.current.level,u.current,o.current,c.current.position))};let w=!1;if(d.x!==h.x){const p=Number(d.x);d.x+=Math.sign(h.x-d.x)*Math.min(i,Math.abs(h.x-d.x)),d.x!==p&&(w=!0)}if(d.y!==h.y){const p=Number(d.y);d.y+=Math.sign(h.y-d.y)*Math.min(i,Math.abs(h.y-d.y)),d.y!==p&&(w=!0)}w&&g();const E=()=>{t.current.timeToMove=performance.now()+1500-t.current.level*50};t.current.timeToMove===void 0&&E(),typeof t.current.timeToMove=="number"&&t.current.timeToMove<performance.now()&&(E(),n.current.forEach(p=>{p.alive&&(p.position.y+=1)}));const S=8*(a/1e3);n.current.forEach(p=>{p.screen.y!==p.position.y&&p.alive&&(p.screen.y+=Math.sign(p.position.y-p.screen.y)*Math.min(S,Math.abs(p.position.y-p.screen.y)),p.screen.y>=o.current-1&&(t.current.lost=!0))})}}function V({context:c}){c.clearRect(0,0,c.canvas.width,c.canvas.height),c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high"}const $="0.0.0-alpha.9",e="floorBlank",r="floorDeath",P=[{id:1,name:"Empty",graphics:{floor:[[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,r],[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r]]}},{id:2,name:"Land filled",graphics:{floor:[[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r]]}}];function _({tiles:{refTileSize:c,refTilesX:n,refTilesY:l},maps:{refMapCurrent:t},graphics:{refGraphics:o},characters:{refUser:u,refBots:s}}){return({context:a})=>{if(c.current){const i=c.current,d=i*n.current,h=i*l.current,g=(a.canvas.width-d)/2,w=(a.canvas.height-h)/2,E=P.filter(v=>v.id===t.current)[0].graphics.floor;for(let v=0;v<l.current;v++)for(let y=0;y<n.current;y++){const f=E[v][y],b=o.current[f];b&&a.drawImage(b,g+y*i,w+v*i,i,i)}const S=u.current,p=g+S.screen.x*i,R=w+S.screen.y*i,A=o.current.charBody;A&&a.drawImage(A,p,R,i,i);const T=o.current.charEyesCenter;T&&a.drawImage(T,p,R,i,i);const M=o.current.charMouthNormal;M&&a.drawImage(M,p,R,i,i);const x=s.current;for(let v=0;v<x.length;v++){const y=x[v];if(y.alive){const f=g+y.screen.x*i,b=w+y.screen.y*i,B=o.current.zombieBody;B&&a.drawImage(B,f,b,i,i);const k=o.current.zombieEyesCenter;k&&a.drawImage(k,f,b,i,i);const z=o.current.zombieMouthNormal;z&&a.drawImage(z,f,b,i,i)}}}}}function q(){const c=m.useRef(0),n=m.useRef(performance.now()),l=m.useRef(0),t={refFPSCounter:c,refFPSStart:n,refFPS:l},o=m.useRef({}),u=m.useRef({loaded:0,total:Object.keys(N).length}),s={refGraphics:o,refGraphicsLoaded:u},a=m.useRef(void 0),i=m.useRef(21),d=m.useRef(12),h={refTileSize:a,refTilesX:i,refTilesY:d},w={refMapCurrent:m.useRef(1)},E=m.useRef({position:{x:Math.round(h.refTilesX.current/2-1),y:Math.round(h.refTilesY.current/2-1)},screen:{x:Math.round(h.refTilesX.current/2-1),y:Math.round(h.refTilesY.current/2-1)},speed:8}),S=m.useRef([]),p={refUser:E,refBots:S},R=m.useRef({}),A=m.useRef({x:0,y:0}),T={refKeyDown:R,refMouse:A},M=m.useRef({screen:"home",screenSelection:"play"}),x=m.useRef({level:0,timeToMove:0,lost:!1,score:0});return{FPS:t,graphics:s,tiles:h,maps:w,characters:p,input:T,game:{refMenu:M,refLevel:x}}}function O({game:{refMenu:c,refLevel:n},tiles:{refTileSize:l}}){return({context:t})=>{if(l.current&&c.current.screen==="home"){t.textBaseline="middle",t.textAlign="center";let o=-4;n.current.lost&&(t.fillStyle="rgba(255,170,170,1)",t.font='bold 32px "Baloo 2 Variable"',t.fillText("You lost!",t.canvas.width/2,t.canvas.height/2+42*o++),t.fillStyle="rgba(255,255,255,0.5)",t.font='bold 20px "Baloo 2 Variable"',t.fillText(`Level: ${n.current.level}`,t.canvas.width/2,t.canvas.height/2-64+20*o++),t.fillText(`Points: ${n.current.score}`,t.canvas.width/2,t.canvas.height/2-64+20*o++)),o=2,t.fillStyle="rgba(255,255,255,0.5)",c.current.screenSelection==="play"&&(t.fillStyle="rgba(170,255,170,1)"),t.font=`${c.current.screenSelection==="play"?"bold":"normal"} 32px "Baloo 2 Variable"`,t.fillText("Play",t.canvas.width/2,t.canvas.height/2+42*o++),t.fillStyle="rgba(255,255,255,0.25)",t.font=`${c.current.screenSelection==="help"?"bold":"normal"} 32px "Baloo 2 Variable"`,t.fillText("Help",t.canvas.width/2,t.canvas.height/2+42*o++),t.fillStyle="rgba(255,255,255,0.25)",t.font=`${c.current.screenSelection==="settings"?"bold":"normal"} 32px "Baloo 2 Variable"`,t.fillText("Settings",t.canvas.width/2,t.canvas.height/2+42*o++),t.fillStyle="rgba(255,255,255,0.5)",t.font='normal 16px "Baloo 2 Variable"',t.fillText(`Version: ${$}`,t.canvas.width/2,t.canvas.height/2+42+42*o++)}}}function X(){return j.jsx(J,{})}const Y=c=>{m.useEffect(()=>{const n=()=>{c.current&&(c.current.width=window.innerWidth,c.current.height=window.innerHeight,c.current.focus())};if(c.current)return n(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[c])},G=c=>{const n=q(),l=async()=>{n.graphics.refGraphicsLoaded.current.loaded=0,n.graphics.refGraphicsLoaded.current.total=Object.keys(N).length;const o=[];for(const u in N){const s=new Promise(a=>{const i=new Image;i.onload=()=>{n.graphics.refGraphics.current[u]=i,n.graphics.refGraphicsLoaded.current.loaded++,a()},i.src="graphics/"+N[u]});o.push(s)}await Promise.all(o)};return m.useEffect(()=>{const o=setTimeout(()=>{l()},0);return()=>{clearTimeout(o)}},[]),m.useEffect(()=>{const o=["F11","F12","F5"],u=a=>{o.includes(a.key)||(a.preventDefault(),n.input.refKeyDown.current[a.code]||(n.input.refKeyDown.current[a.code]=performance.now()))},s=a=>{o.includes(a.key)||(a.preventDefault(),n.input.refKeyDown.current[a.code]&&(n.input.refKeyDown.current[a.code]=!1))};return window.addEventListener("keydown",u),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",u),window.removeEventListener("keyup",s)}},[]),m.useEffect(()=>{const o=u=>{n.input.refMouse.current={x:u.clientX,y:u.clientY}};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[]),m.useMemo(()=>{const o=[];return o.push(V),o.push(F(n)),o.push(H(n)),o.push(_(n)),o.push(C(n)),o.push(W(n)),o.push(O(n)),o},[])},Q=(c,n)=>{const l=m.useRef(0),t=m.useRef(null);m.useEffect(()=>{const o=c.current||null;if(!o)return;l.current=0;const u=s=>{const a=s-l.current;let i=0;const d=n.length;do n[i]({ticks:a,context:o.getContext("2d")}),i++;while(i<d);l.current=s,t.current=requestAnimationFrame(u)};return u(0),()=>{t.current&&cancelAnimationFrame(t.current)}},[c])};function J(){const c=m.useRef(null);Y(c);const n=G();Q(c,n);const[l,t]=m.useState(void 0),[o,u]=m.useState(void 0);return m.useEffect(()=>{const s=()=>{t(window.innerWidth),u(window.innerHeight)};if(c.current)return window.addEventListener("resize",s),s(),()=>{window.removeEventListener("resize",s)}},[c]),j.jsx("canvas",{tabIndex:0,className:"h-full w-full translate-x-0 transform-gpu focus-within:outline-none",style:{shapeRendering:"crispEdges"},ref:c,width:l,height:o})}globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;function K(){return j.jsx(L,{children:j.jsx("div",{className:"grid h-full w-full place-items-center",children:j.jsx("div",{className:"h-full w-full bg-black",children:j.jsx(X,{})})})})}export{K as default};
